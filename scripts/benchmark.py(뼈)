import time
from camera import Camera
from detection import Detector
from utils.config_loader import load_yaml

def main():
    config = load_yaml("config/config.yaml")
    paths = load_yaml("config/paths.yaml")

    cam_cfg = config["camera"]

    camera = Camera(
        device_index=cam_cfg.get("device_index", 0),
        width=cam_cfg.get("width", 640),
        height=cam_cfg.get("height", 480),
    )

    detector = Detector(
        backend="cpu",
        model_path=paths["models"]["yolov8_face_onnx"],
    )

    num_frames = 100
    start = time.time()

    for _ in range(num_frames):
        frame = camera.get_frame()
        if frame is None:
            continue
        _ = detector.detect_faces(frame)

    end = time.time()
    elapsed = end - start
    fps = num_frames / elapsed
    print(f"{num_frames} frames processed in {elapsed:.2f}s, FPS={fps:.2f}")

    camera.release()

if __name__ == "__main__":
    main()
